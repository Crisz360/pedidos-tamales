<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedido de Tamales</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Toastr CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet">
    <!-- Lightbox CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'arial', sans-serif;
        }
        #title{
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
        }
        .datainput {
            text-align: center;
            font-size: 1rem;
            font-weight: bold;;
        }
        .subtitles{
            text-align: justify;
            font-size: 1.5rem;
            font-weight: bold;
            color: #d35400;
        }
        .product-card {
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }
        .product-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .quantity-btn {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .bank-info {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            display: none;
        }
        .header {
            background-color: #d35400;
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
            border-radius: 0 0 10px 10px;
        }
        .btn-primary {
            background-color: #d35400;
            border-color: #d35400;
        }
        .btn-primary:hover {
            background-color: #e67e22;
            border-color: #e67e22;
        }
        .total-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #d35400;
        }
        .product-img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .product-img:hover {
            transform: scale(1.05);
        }
        .img-preview {
            max-width: 200px;
            max-height: 200px;
            display: none;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .lightbox .lb-close {
            top: 20px;
            right: 20px;
        }
        .error-border {
            border: 1px solid #dc3545 !important;
        }
        @media (max-width: 768px) {
            .product-img {
                width: 60px;
                height: 60px;
            }
            .quantity-btn {
                width: 25px;
                height: 25px;
                font-size: 0.8rem;
            }
            .quantity {
                margin: 0 5px;
            }
        }
    </style>
</head>
<body>
    <div class="header text-center">
        <h1 id="title">¡Ordena Tus Tamales!</h1>
        <p class="lead">Deliciosos tamales</p>
    </div>

    <div class="container">
        <form id="pedidoForm" action="https://formsubmit.co/tucorreo@gmail.com" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="_next" id="_next_url" value="">
            <input type="hidden" name="_subject" value="Nuevo pedido de tamales">
            <input type="hidden" name="_template" value="table">
            <input type="hidden" name="_captcha" value="false">
            <input type="hidden" name="pedido_json" id="pedido-json" value="">

            <h3 class="mb-3 subtitles">Datos del Cliente <span class="text-danger">*</span></h3>

            <div class="row mb-4">
                <div class="col-md-6 mb-3">
                    <label for="nombre" class="form-label datainput">Nombre completo: <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="nombre" name="nombre" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="telefono" class="form-label datainput">Teléfono: <span class="text-danger">*</span></label>
                    <input type="tel" class="form-control" id="telefono" name="telefono" required>
                </div>
            </div>

            <h3 class="mb-3 subtitles">Nuestros Tamales <span class="text-danger">*</span></h3>
            <p class="text-muted mb-3">Selecciona al menos un tamal</p>
            
            <div class="card product-card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-1">
                            <a href="https://img.chilango.com/cdn-cgi/image/width=1200,quality=75,format=auto,onerror=redirect/2025/01/feria-del-tamal-2025-cdmx-monumento-a-la-revolucion.jpg" data-lightbox="tamal-rojo" data-title="Tamal de Salsa Roja">
                                <img src="https://img.chilango.com/cdn-cgi/image/width=1200,quality=75,format=auto,onerror=redirect/2025/01/feria-del-tamal-2025-cdmx-monumento-a-la-revolucion.jpg" alt="Tamal Rojo" class="product-img">
                            </a>
                        </div>
                        <div class="col-md-5">
                            <h5 class="card-title">Tamal de Salsa Roja</h5>
                            <p class="card-text text-success">$26 c/u</p>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-center justify-content-end">
                                <button type="button" class="btn btn-outline-secondary quantity-btn minus" data-product="tamal-rojo">-</button>
                                <span class="quantity mx-2" id="tamal-rojo-qty">0</span>
                                <button type="button" class="btn btn-outline-secondary quantity-btn plus" data-product="tamal-rojo">+</button>
                                <input type="hidden" name="tamal-rojo" id="tamal-rojo" value="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card product-card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-1">
                            <a href="https://img.chilango.com/cdn-cgi/image/width=1200,quality=75,format=auto,onerror=redirect/2025/01/feria-del-tamal-2025-cdmx-monumento-a-la-revolucion.jpg" data-lightbox="tamal-verde" data-title="Tamal de Salsa Verde">
                                <img src="https://img.chilango.com/cdn-cgi/image/width=1200,quality=75,format=auto,onerror=redirect/2025/01/feria-del-tamal-2025-cdmx-monumento-a-la-revolucion.jpg" alt="Tamal Verde" class="product-img">
                            </a>
                        </div>
                        <div class="col-md-5">
                            <h5 class="card-title">Tamal de Salsa Verde</h5>
                            <p class="card-text text-success">$26 c/u</p>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-center justify-content-end">
                                <button type="button" class="btn btn-outline-secondary quantity-btn minus" data-product="tamal-verde">-</button>
                                <span class="quantity mx-2" id="tamal-verde-qty">0</span>
                                <button type="button" class="btn btn-outline-secondary quantity-btn plus" data-product="tamal-verde">+</button>
                                <input type="hidden" name="tamal-verde" id="tamal-verde" value="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card product-card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-1">
                            <a href="https://img.chilango.com/cdn-cgi/image/width=1200,quality=75,format=auto,onerror=redirect/2025/01/feria-del-tamal-2025-cdmx-monumento-a-la-revolucion.jpg" data-lightbox="tamal-kool" data-title="Tamal de Salsa Kool">
                                <img src="https://img.chilango.com/cdn-cgi/image/width=1200,quality=75,format=auto,onerror=redirect/2025/01/feria-del-tamal-2025-cdmx-monumento-a-la-revolucion.jpg" alt="Tamal Kool" class="product-img">
                            </a>
                        </div>
                        <div class="col-md-5">
                            <h5 class="card-title">Tamal de Salsa Kool</h5>
                            <p class="card-text text-success">$27 c/u</p>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-center justify-content-end">
                                <button type="button" class="btn btn-outline-secondary quantity-btn minus" data-product="tamal-kool">-</button>
                                <span class="quantity mx-2" id="tamal-kool-qty">0</span>
                                <button type="button" class="btn btn-outline-secondary quantity-btn plus" data-product="tamal-kool">+</button>
                                <input type="hidden" name="tamal-kool" id="tamal-kool" value="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <h3 class="mt-4 mb-3 subtitles">Método de Pago <span class="text-danger">*</span></h3>
            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="metodo-pago" id="efectivo" value="efectivo" checked>
                    <label class="form-check-label" for="efectivo">
                        Efectivo al recibir
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="metodo-pago" id="transferencia" value="transferencia">
                    <label class="form-check-label" for="transferencia">
                        Transferencia bancaria
                    </label>
                </div>
            </div>

            <div id="bank-info-container" class="bank-info">
                <h5>Datos Bancarios para Transferencia</h5>
                <ul class="list-unstyled">
                    <li><strong>Banco:</strong> BBVA</li>
                    <li><strong>Nombre:</strong> Tamales Doña Maria</li>
                    <li><strong>CLABE:</strong> 0123 4567 8910 1112</li>
                    <li><strong>Tarjeta:</strong> 4152 3134 5678 9012</li>
                </ul>
                <div class="mb-3">
                    <label for="comprobante" class="form-label">Subir comprobante de transferencia *</label>
                    <input class="form-control" type="file" id="comprobante" name="comprobante" accept="image/*" onchange="previewImage(this)">
                    <img id="comprobante-preview" class="img-preview" alt="Vista previa del comprobante">
                </div>
            </div>

            <div class="d-flex justify-content-between align-items-center mt-4 p-3 bg-light rounded">
                <h4 class="mb-0">Total a pagar:</h4>
                <div class="total-display" id="total">$0</div>
                <input type="hidden" name="total" id="total-hidden">
            </div>

            <div class="d-grid gap-2 mt-4">
                <button type="submit" class="btn btn-primary btn-lg">Enviar Pedido</button>
            </div>
        </form>
    </div>

    <!-- Bootstrap JS + Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery + Toastr JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <!-- Lightbox JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>
    
    <script>
        toastr.options = {
            "closeButton": true,
            "positionClass": "toast-top-right",
            "preventDuplicates": true,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000"
        };

        const prices = {
            "tamal-rojo": 26,
            "tamal-verde": 26,
            "tamal-kool": 27
        };
        
        function updateTotal() {
            let total = 0;
            let hasSelection = false;
            
            Object.keys(prices).forEach(product => {
                const qty = parseInt($(`#${product}`).val()) || 0;
                total += qty * prices[product];
                if (qty > 0) hasSelection = true;
            });
            
            $("#total").text(`$${total}`);
            $("#total-hidden").val(total);
            
            if (hasSelection) {
                $(".product-card").removeClass("error-border");
            }
        }
        
        $(".plus").click(function() {
            const product = $(this).data("product");
            const qtyElement = $(`#${product}-qty`);
            const inputElement = $(`#${product}`);
            let qty = parseInt(qtyElement.text());
            qty++;
            qtyElement.text(qty);
            inputElement.val(qty);
            updateTotal();
        });
        
        $(".minus").click(function() {
            const product = $(this).data("product");
            const qtyElement = $(`#${product}-qty`);
            const inputElement = $(`#${product}`);
            let qty = parseInt(qtyElement.text());
            if (qty > 0) {
                qty--;
                qtyElement.text(qty);
                inputElement.val(qty);
                updateTotal();
            }
        });
        
        $("input[name='metodo-pago']").change(function() {
            if ($("#transferencia").is(":checked")) {
                $("#bank-info-container").show();
            } else {
                $("#bank-info-container").hide();
            }
        });
        
        function previewImage(input) {
            const preview = document.getElementById('comprobante-preview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        // Configurar la URL base para la redirección
        const baseUrl = window.location.href.includes('github.io') ? 
            'https://tunombredeusuario.github.io/turepositorio/' : 
            window.location.origin + '/';
        
        $("#pedidoForm").submit(function(e) {
            let isValid = true;
            let hasSelection = false;

            Object.keys(prices).forEach(product => {
                const qty = parseInt($(`#${product}`).val()) || 0;
                if (qty > 0) hasSelection = true;
            });

            if (!hasSelection) {
                toastr.error("¡Debes seleccionar al menos un tamal!");
                $(".product-card").addClass("error-border");
                isValid = false;
            }
            
            const nombre = $("#nombre").val().trim();
            if (nombre === "") {
                toastr.error("Por favor ingresa tu nombre completo");
                isValid = false;
            }
            
            const telefono = $("#telefono").val().trim();
            if (telefono === "") {
                toastr.error("Por favor ingresa tu número de teléfono");
                isValid = false;
            } else if (!/^[0-9]{10}$/.test(telefono)) {
                toastr.error("Por favor ingresa un número de teléfono válido (10 dígitos)");
                isValid = false;
            }
            
            const metodoPago = $("input[name='metodo-pago']:checked").val();
            if (!metodoPago) {
                toastr.error("Por favor selecciona un método de pago");
                isValid = false;
            }
            
            if (metodoPago === "transferencia" && $("#comprobante").val() === "") {
                toastr.error("¡Debes subir el comprobante de transferencia!");
                isValid = false;
            }

            if (isValid) {
                const pedido = {
                    nombre: $("#nombre").val(),
                    telefono: $("#telefono").val(),
                    productos: {
                        rojo: $("#tamal-rojo").val(),
                        verde: $("#tamal-verde").val(),
                        kool: $("#tamal-kool").val()
                    },
                    total: $("#total-hidden").val(),
                    metodoPago: metodoPago
                };

                // Codificar el objeto pedido para URL
                const pedidoCodificado = encodeURIComponent(JSON.stringify(pedido));
                
                // Guardar el JSON en el campo hidden
                $("#pedido-json").val(pedidoCodificado);
                
                // Construir la URL de redirección
                const nextUrl = `${baseUrl}gracias.html?pedido=${pedidoCodificado}`;
                
                // Actualizar el campo _next del formulario
                $("#_next_url").val(nextUrl);
                
                toastr.success("¡Gracias por tu pedido! Estamos procesando tu solicitud.");
            } else {
                e.preventDefault();
            }
        });

        lightbox.option({
            'resizeDuration': 200,
            'wrapAround': true,
            'showImageNumberLabel': false,
            'disableScrolling': true
        });
    </script>
</body>
</html>
